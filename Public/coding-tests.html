<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coding Tests - Stamp</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.30.1/min/vs/editor/editor.main.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.30.1/min/vs/loader.js"></script>
    <style>
      .main-content {
          display: flex;
          flex-wrap: wrap;
          gap: 1rem;
      }

      .main-content .left-column {
          flex: 1;
          min-width: 300px;
      }

      .main-content .right-column {
          flex: 1;
          min-width: 300px;
      }

      .main-content .right-column .section-title {
          text-align: center;
      }
  </style>
</head>

<body>
    <!-- Header and Navigation -->
    <!-- ... -->

    <header>
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
          <div class="container">
            <a class="navbar-brand" href="index.html">Stamp</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
              <ul class="navbar-nav">
                <li class="nav-item">
                  <a class="nav-link" href="index.html">Home</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="features.html">Features & Benefits</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="testimonials.html">Testimonials & Success Stories</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="pricing.html">Pricing & Packages</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="demo.html">Try Our Tests (Demo)</a>
                </li>
              </ul>
            </div>
          </div>
        </nav>
      </header>

      <main>
        <!-- Introduction -->
        <section class="container main-content">
            <div class="left-column">
                <h2 class="section-title">Coding Test</h2>
                <p>Please read the below task and use the IDE to code the soltution. You have 30 minutes to complete the task.</p>
                <p>Using Python, write code to calculate the factorial of a number, and produce a sentence "the factorial of X is Y. In this instance X=5.".</p>
                <button id="download-csv" class="btn btn-primary">Download CSV Dataset</button>
                <p>Paste the CSV data below:</p>
                <textarea id="csv-data" rows="10" class="form-control mb-3" style="border: 1px solid black;"></textarea>
                <h4>Output</h4>
                <div id="output-container" class="mt-3" style="border: 1px solid black; padding: 10px; height: 100px;">
                    <pre id="output"></pre>
                </div>
                <button id="submit-answer" class="btn btn-primary mt-3" style="display: none;">Submit Answer</button>
                <div id="explanation-container" style="display: none;">
                  <h4>Please write a few sentences about your answer</h4>
                  <p>(This can be used by the hiring manager to understand how you answered the case)</p>
                  <textarea id="explanation" rows="3" class="form-control mb-3" style="border: 1px solid black;"></textarea>
                  <button id="submit-explanation" class="btn btn-primary">Submit Explanation</button>
                </div>
            </div>
            <div class="right-column">
            </div>
            <div class="right-column">
                <h4 class="section-title">Code here</h4>
                <div id="monaco-editor-container" style="padding: 10px; height: 400px; overflow: hidden;"></div>
                <button id="run-code" class="btn btn-primary mt-3">Run Code</button>
            </div>
        </section>
      </main>
          <script src="js/bootstrap.bundle.min.js"></script>
      
          <script>
            require.config({
              paths: {
                'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.30.1/min/vs'
              }
            });
          
            let editor;
            require(['vs/editor/editor.main'], function () {
              editor = monaco.editor.create(document.getElementById('monaco-editor-container'), {
                value: [
                  'print("Hello, world!")',
                ].join('\n'),
                language: 'python'
              });
          
              editor.updateOptions({ theme: 'vs-dark' });
            });
          
            let csvData = "";
          
            async function fetchCSVData() {
              const response = await fetch("https://raw.githubusercontent.com/JohnJoeKC/Stamp_V2/main/Datasets/Sample_set_1.csv");
              csvData = await response.text();
            }
          
            fetchCSVData();
          
            async function loadPyodide() {
              if (typeof pyodide === "undefined") {
                await loadScript(`${pyodideUrl}pyodide.js`);
              }
              await window.languagePluginLoader;
              await pyodide.loadPackage(["numpy", "pandas"]);
            }
          
            async function loadScript(src) {
              return new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.src = src;
                script.onload = () => {
                  resolve();
                };
                script.onerror = () => {
                  reject(new Error(`Failed to load script: ${src}`));
                };
                document.head.appendChild(script);
              });
            }
          
            (async () => {
              const pyodideUrl = "https://cdn.jsdelivr.net/pyodide/v0.18.1/full/";
              await loadScript(`${pyodideUrl}pyodide.js`);
          
              await loadPyodide();
          
              async function executeCode() {
                const code = editor.getValue();
                console.log("Code:", code);
          
                const csvData = document.getElementById("csv-data").value;
          
                try {
                  const modifiedCode = code.replace(/sys\.stdin\.read\(\)/g, `\`${csvData}\``);
                  const output = await pyodide.runPythonAsync(modifiedCode);
                  console.log("Output:", output);
                  document.getElementById("output").innerText = output;
                } catch (error) {
                  console.error("Error:", error);
                  document.getElementById("output").innerText = error.message;
                }
              }
          
              document.getElementById("run-code").addEventListener("click", executeCode);
          
              document.getElementById("download-csv").addEventListener("click", () => {
                const blob = new Blob([csvData], { type: "text/csv" });
                const url = URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.href = url;
                link.download = "sample_dataset.csv";
                link.click();
                URL.revokeObjectURL(url);
              });
          
              document.getElementById("submit-answer").addEventListener("click", () => {
                document.getElementById("submit-answer").style.display = "none";
                document.getElementById("explanation-container").style.display = "block";
              });
          
              document.getElementById("submit-explanation").addEventListener("click", () => {
                const explanation = document.getElementById("explanation").value;
                console.log("Explanation:", explanation);
                alert("Explanation submitted successfully!");
              });
            })();
          </script>          
          
    </body>

</html>