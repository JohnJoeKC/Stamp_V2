<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coding Tests - Stamp</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.30.1/min/vs/editor/editor.main.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.30.1/min/vs/loader.js"></script>
    <style>
      .main-content {
          display: flex;
          flex-wrap: wrap;
          gap: 1rem;
      }

      .main-content .left-column {
          flex: 1;
          min-width: 300px;
      }

      .main-content .right-column {
          flex: 1;
          min-width: 300px;
      }

      .main-content .right-column .section-title {
          text-align: center;
      }
  </style>
</head>

<body>
    <!-- Header and Navigation -->
    <!-- ... -->

    <header>
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
          <div class="container">
            <a class="navbar-brand" href="index.html">Stamp</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
              <ul class="navbar-nav">
                <li class="nav-item">
                  <a class="nav-link" href="index.html">Home</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="features.html">Features & Benefits</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="testimonials.html">Testimonials & Success Stories</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="pricing.html">Pricing & Packages</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="demo.html">Try Our Tests (Demo)</a>
                </li>
              </ul>
            </div>
          </div>
        </nav>
      </header>

      <main>
        <!-- Introduction -->
        <section class="container main-content">
            <div class="left-column">
                <h2 class="section-title">Coding Test</h2>
                <p>Please read the below task and use the IDE to code the soltution. You have 30 minutes to complete the task.</p>
                <p>Using Python, write code to calculate the factorial of a number, and produce a sentence "the factorial of X is Y. In this instance X=5.".</p>
                <a id="download-csv" href="#" download="Sample_set_1.csv">Download CSV Dataset</a>
                <h4>Output</h4>
                <div id="output-container" class="mt-3" style="border: 1px solid black; padding: 10px; height: 100px;">
                    <pre id="output"></pre>
                </div>
                <button id="submit-answer" class="btn btn-primary mt-3" style="display: none;">Submit Answer</button>
                <div id="explanation-container" style="display: none;">
                  <h4>Please write a few sentences about your answer</h4>
                  <p>(This can be used by the hiring manager to understand how you answered the case)</p>
                  <textarea id="explanation" rows="3" class="form-control mb-3" style="border: 1px solid black;"></textarea>
                  <button id="submit-explanation" class="btn btn-primary">Submit Explanation</button>
                </div>
            </div>
            <div class="right-column">
                <h4 class="section-title">Code here</h4>
                <div id="monaco-editor-container" style="padding: 10px; height: 400px; overflow: hidden;"></div>
                <button id="run-code" class="btn btn-primary mt-3">Run Code</button>
            </div>
        </section>
      </main>
            <script src="js/bootstrap.bundle.min.js"></script>
  
            <script>
              require.config({
                paths: {
                  'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.30.1/min/vs'
                }
              });
            
              let editor;
              require(['vs/editor/editor.main'], function () {
                editor = monaco.editor.create(document.getElementById('monaco-editor-container'), {
                  value: [
                    'print("Hello, world!")',
                  ].join('\n'),
                  language: 'python'
                });
            
                editor.updateOptions({ theme: 'vs-dark' }); // Add this line
              });

            // Function to execute the code
            async function executeCode() {
                const code = editor.getValue();
                console.log('Code:', code);

                const requestOptions = {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        code: code,
                        language: 'python',
                    }),
                };

                fetch('https://stamp-v2.herokuapp.com/execute', requestOptions)
                    .then((response) => response.json())
                    .then((data) => {
                        if (data.error) {
                            console.error('Response:', data);
                            outputElement.textContent = 'An error occurred while executing the code.';
                        } else {
                            outputElement.textContent = data.output;
                        }
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });

                    const outputElement = document.getElementById('output');
                    document.getElementById("output-container").style.display = "block";
                    document.getElementById("submit-answer").style.display = "block";
            }

            // Add click event listener to the "Run Code" button
            const runCodeButton = document.getElementById('run-code');
            runCodeButton.addEventListener('click', executeCode);
            function exportCSV() {
                const output = document.getElementById("output").textContent;

                const csvContent = "data:text/csv;charset=utf-8,Output\n" + output;

                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "output_results.csv");
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }

            const submitOutputButton = document.getElementById("submit-answer");
            submitOutputButton.addEventListener("click", exportCSV);
            
            function showExplanationInput() {
              document.getElementById("explanation-container").style.display = "block";
            }

            submitOutputButton.addEventListener("click", showExplanationInput);
            const downloadCSVLink = document.getElementById('download-csv');
            downloadCSVLink.href = 'https://raw.githubusercontent.com/JohnJoeKC/Stamp_V2/main/Datasets/Sample_set_1.csv';
            downloadCSVLink.setAttribute('download', 'Sample_set_1.csv');
    </script>

    </body>

</html>